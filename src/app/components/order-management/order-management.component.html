<app-admin-navbar></app-admin-navbar>

<div class="container py-4">
  <h2 class="mb-4">Order Management</h2>

  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Order Number</th>
        <th>Customer Name</th>
        <th>Customer Phone</th>
        <th>Order Date</th>
        <th>Total Price</th>
        <th>Order Status</th>
        <th>Delivery Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of orders">
        <td>{{ order.id }}</td>
        <td>{{ order.orderNumber }}</td>
        <td>{{ order.customerName }}</td>
        <td>{{ order.customerPhone }}</td>
        <td>{{ order.orderDate }}</td>
        <td>${{ getTotal(order) }}</td>
        <td>
          <span class="badge bg-primary">{{ order.status }}</span>
        </td>
        <td>{{ order.deliveryDate }}</td>
        <td>
          <button class="btn btn-sm btn-info me-1" data-bs-toggle="modal" data-bs-target="#viewOrderModal"
                  (click)="openOrderModal(order)">View</button>
          <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#viewOrderModal"
                  (click)="openOrderModal(order)">Edit</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- View/Edit Modal -->
  <div class="modal fade" id="viewOrderModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" *ngIf="selectedOrder">
        <div class="modal-header">
          <h5 class="modal-title">Order Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-4"><strong>Order Number:</strong> {{ selectedOrder.orderNumber }}</div>
            <div class="col-md-4"><strong>Customer Name:</strong> {{ selectedOrder.customerName }}</div>
            <div class="col-md-4"><strong>Customer Phone:</strong> {{ selectedOrder.customerPhone }}</div>
          </div>
          <div class="row mb-3" [formGroup]="orderForm">
            <div class="col-md-4"><strong>Order Date:</strong> {{ selectedOrder.orderDate }}</div>
            <div class="col-md-4">
              <label class="form-label"><strong>Order Status:</strong></label>
              <select class="form-select" formControlName="status">
                <option>New</option>
                <option>Confirmed</option>
                <option>Cancelled</option>
                <option>Delivered</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label"><strong>Delivery Date:</strong></label>
              <input type="date" class="form-control" formControlName="deliveryDate">
            </div>
          </div>
          <div class="mt-3">
            <p><strong>Shipping Address:</strong> {{ selectedOrder.shippingAddress }}</p>
          </div>
          <div class="mb-3" [formGroup]="orderForm">
            <label class="form-label"><strong>Customer Notes:</strong></label>
            <textarea class="form-control" rows="2" formControlName="customerNotes"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label"><strong>Rating & Feedback:</strong></label>
            <textarea class="form-control" rows="2" [value]="selectedOrder.feedback" disabled></textarea>
          </div>

          <h5 class="mt-4">Order Items</h5>
          <table class="table">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Unit Price</th>
                <th>Quantity</th>
                <th>Net Price</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of selectedOrder.items; let i = index">
                <td>{{ item.productName }}</td>
                <td>${{ item.unitPrice }}</td>
                <td>{{ item.quantity }}</td>
                <td>${{ item.netPrice }}</td>
                <td>
                  <button class="btn btn-sm btn-danger" (click)="removeItem(i)">Remove</button>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="text-end">Total:</th>
                <th>${{ getTotal(selectedOrder) }}</th>
                <th></th>
              </tr>
            </tfoot>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" (click)="cancelOrder()">Cancel Order</button>
          <button type="button" class="btn btn-success" (click)="confirmOrder()">Confirm Order</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
